<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Notification Web Simple</title>
</head>
<body>
  <h1>Notification Web</h1>
  <button id="notifyBtn">Envoyer une notification</button>

  <script>
    // Contenu du service worker (inline)
    const swCode = `
      self.addEventListener('notificationclick', function(event) {
        event.notification.close();
        event.waitUntil(
          clients.openWindow('https://example.com')
        );
      });
    `;

    // CrÃ©e un blob et un URL temporaire pour le service worker
    const swBlob = new Blob([swCode], { type: 'application/javascript' });
    const swUrl = URL.createObjectURL(swBlob);

    // VÃ©rifie le support
    if ('Notification' in window && 'serviceWorker' in navigator) {
      // Enregistre le service worker Ã  partir du blob
      navigator.serviceWorker.register(swUrl).then(() => {
        console.log('Service Worker enregistrÃ© avec succÃ¨s.');
      }).catch(err => console.error('Erreur SW :', err));

      // Demande permission
      Notification.requestPermission().then(permission => {
        if (permission !== 'granted') {
          alert('Permission de notifications refusÃ©e.');
        }
      });

      // Action bouton
      document.getElementById('notifyBtn').addEventListener('click', () => {
        if (Notification.permission === 'granted') {
          navigator.serviceWorker.getRegistration().then(reg => {
            if (reg) {
              reg.showNotification('Hello ! ðŸ‘‹', {
                body: 'Ceci est une notification envoyÃ©e depuis la page.',
                icon: 'https://via.placeholder.com/128',
                tag: 'demo'
              });
            }
          });
        }
      });
    } else {
      alert("Notifications ou Service Workers non supportÃ©s.");
    }
  </script>
</body>
</html>
